<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
     <meta charset="utf-8">
     <title>Tic-Tac-Toe</title>
     <!-- Google Fonts -->
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Praise&family=Viga&display=swap" rel="stylesheet">
     <!-- Bootstrap CSS -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
     <!-- Custom CSS -->
     <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
     <h1>Tic-Tac-Toe</h1>
     <form action="/" method="post">
          <table>
               <tr>
                    <td>
                         <div id="1"><img src=""></div>
                    </td>
                    <td class="mid-col">
                         <div id="2"><img src=""></div>
                    </td>
                    <td>
                         <div id="3"><img src=""></div>
                    </td>
               </tr>
               <tr class="mid-row">
                    <td>
                         <div id="4"><img src=""></div>
                    </td>
                    <td class="mid-col">
                         <div id="5"><img src=""></div>
                    </td>
                    <td>
                         <div id="6"><img src=""></div>
                    </td>
               </tr>
               <tr>
                    <td>
                         <div id="7"><img src=""></div>
                    </td>
                    <td class="mid-col">
                         <div id="8"><img src=""></div>
                    </td>
                    <td>
                         <div id="9"><img src=""></div>
                    </td>
               </tr>
          </table>
          <div class="Play">Play!</div>
     </form>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
     <script>
          let x = true;
          let moves = 0;
          const placed = [];
          let isPlaying = false;
          //Play Button
          $(".Play").on("click", function() {
               for(var i = 1; i <= 9; i++) {
                    $("#" + i).html("<img src = ''>");
                    moves = 0; x = true; placed.length = 0;
                    $("h1").text("Tic-Tac-Toe");
                    $(".Play").text("Restart");
               }
               isPlaying = true;
          });

          //Placing X and O

          $("td div").on("click", function() {
               if(isPlaying) {
                    if (x) {
                         if (placed[this.id] == null && winner() == undefined) {
                              $("#" + this.id).html("<img src = '/images/close.png'>");
                              placed[this.id] = "X";
                              moves++;
                              x = false;
                         }
                    } else {
                         if (placed[this.id] == null && winner() == undefined) {
                              $("#" + this.id).html("<img src = '/images/circle.png'>");
                              placed[this.id] = "O";
                              moves++;
                              x = true;
                         }
                    }
                    if (moves >= 3) {
                         if (winner() != undefined) {
                              if (winner() != "Draw") {
                                   $("h1").text("Winner is " + winner());
                              } else {
                                   $("h1").text("It's a " + winner());
                              }
                         }
                    }
                    console.log(isPlaying);
               }
          });

          //Determine the Winner
          function winner() {
               let winner = "Draw";
               //Check the winner from the middle square
               for (var i = 0; i < 4; i++) {
                    if (placed[i + 1] == placed[5] && placed[5] == placed[9 - i] && placed[5] != null) {
                         winner = placed[5];
                         isPlaying = false;
                         return winner;
                    }
               }
               //Check the winner from side squares
               for (var i = 1; i <= 4; i++) {
                    let sideMid = Math.ceil(i * 2);
                    if (Math.ceil(sideMid / 3) == 2) {
                         if (placed[sideMid] != null && placed[sideMid] == placed[sideMid - 3] && placed[sideMid] == placed[sideMid + 3]) {
                              winner = placed[sideMid];
                              isPlaying = false;
                              return winner;
                         }
                    } else {
                         if (placed[sideMid] != null && placed[sideMid] == placed[sideMid - 1] && placed[sideMid] == placed[sideMid + 1]) {
                              winner = placed[sideMid];
                              isPlaying = false;
                              return winner;
                         }
                    }
               }

               if (winner == "Draw") {
                    if (moves >= 9) {
                         isPlaying = false;
                         return winner;
                    }
               }

          }
     </script>
</body>

</html>
